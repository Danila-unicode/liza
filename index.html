<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LizaApp - –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="styles.css">
    <!-- Capacitor —Å–∫—Ä–∏–ø—Ç—ã -->
    <script type="module" src="https://unpkg.com/@capacitor/core@latest/dist/capacitor.js"></script>
</head>
<body class="register-body">
    <div class="register-container">
        <div class="auth-logo">
            <img src="logo.png" alt="LizaApp" class="auth-logo-image">
        </div>
        <h1 class="register-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ LizaApp</h1>

        <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
        <form id="loginForm" method="POST" autocomplete="off" style="display: block;">
            <div class="register-form-group">
                <label for="countryCode" class="register-form-label">–°—Ç—Ä–∞–Ω–∞</label>
                <select name="countryCode" id="countryCode" class="register-form-input" required>
                    <option value="+7" selected>+7 –†–æ—Å—Å–∏—è</option>
                    <option value="+1">+1 –°–®–ê/–ö–∞–Ω–∞–¥–∞</option>
                    <option value="+44">+44 –í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è</option>
                    <option value="+49">+49 –ì–µ—Ä–º–∞–Ω–∏—è</option>
                    <option value="+33">+33 –§—Ä–∞–Ω—Ü–∏—è</option>
                    <option value="+39">+39 –ò—Ç–∞–ª–∏—è</option>
                    <option value="+34">+34 –ò—Å–ø–∞–Ω–∏—è</option>
                    <option value="+31">+31 –ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã</option>
                    <option value="+32">+32 –ë–µ–ª—å–≥–∏—è</option>
                    <option value="+41">+41 –®–≤–µ–π—Ü–∞—Ä–∏—è</option>
                    <option value="+43">+43 –ê–≤—Å—Ç—Ä–∏—è</option>
                    <option value="+45">+45 –î–∞–Ω–∏—è</option>
                    <option value="+46">+46 –®–≤–µ—Ü–∏—è</option>
                    <option value="+47">+47 –ù–æ—Ä–≤–µ–≥–∏—è</option>
                    <option value="+48">+48 –ü–æ–ª—å—à–∞</option>
                    <option value="+420">+420 –ß–µ—Ö–∏—è</option>
                    <option value="+421">+421 –°–ª–æ–≤–∞–∫–∏—è</option>
                    <option value="+36">+36 –í–µ–Ω–≥—Ä–∏—è</option>
                    <option value="+40">+40 –†—É–º—ã–Ω–∏—è</option>
                    <option value="+359">+359 –ë–æ–ª–≥–∞—Ä–∏—è</option>
                    <option value="+385">+385 –•–æ—Ä–≤–∞—Ç–∏—è</option>
                    <option value="+386">+386 –°–ª–æ–≤–µ–Ω–∏—è</option>
                    <option value="+372">+372 –≠—Å—Ç–æ–Ω–∏—è</option>
                    <option value="+371">+371 –õ–∞—Ç–≤–∏—è</option>
                    <option value="+370">+370 –õ–∏—Ç–≤–∞</option>
                    <option value="+7">+7 –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω</option>
                    <option value="+998">+998 –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω</option>
                    <option value="+996">+996 –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω</option>
                    <option value="+992">+992 –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω</option>
                    <option value="+993">+993 –¢—É—Ä–∫–º–µ–Ω–∏—Å—Ç–∞–Ω</option>
                    <option value="+374">+374 –ê—Ä–º–µ–Ω–∏—è</option>
                    <option value="+995">+995 –ì—Ä—É–∑–∏—è</option>
                    <option value="+994">+994 –ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω</option>
                    <option value="+380">+380 –£–∫—Ä–∞–∏–Ω–∞</option>
                    <option value="+375">+375 –ë–µ–ª–∞—Ä—É—Å—å</option>
                    <option value="+373">+373 –ú–æ–ª–¥–æ–≤–∞</option>
                    <option value="+381">+381 –°–µ—Ä–±–∏—è</option>
                    <option value="+382">+382 –ß–µ—Ä–Ω–æ–≥–æ—Ä–∏—è</option>
                    <option value="+383">+383 –ö–æ—Å–æ–≤–æ</option>
                    <option value="+387">+387 –ë–æ—Å–Ω–∏—è –∏ –ì–µ—Ä—Ü–µ–≥–æ–≤–∏–Ω–∞</option>
                    <option value="+389">+389 –ú–∞–∫–µ–¥–æ–Ω–∏—è</option>
                    <option value="+355">+355 –ê–ª–±–∞–Ω–∏—è</option>
                    <option value="+30">+30 –ì—Ä–µ—Ü–∏—è</option>
                    <option value="+90">+90 –¢—É—Ä—Ü–∏—è</option>
                    <option value="+86">+86 –ö–∏—Ç–∞–π</option>
                    <option value="+81">+81 –Ø–ø–æ–Ω–∏—è</option>
                    <option value="+82">+82 –Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è</option>
                    <option value="+65">+65 –°–∏–Ω–≥–∞–ø—É—Ä</option>
                    <option value="+60">+60 –ú–∞–ª–∞–π–∑–∏—è</option>
                    <option value="+66">+66 –¢–∞–∏–ª–∞–Ω–¥</option>
                    <option value="+84">+84 –í—å–µ—Ç–Ω–∞–º</option>
                    <option value="+63">+63 –§–∏–ª–∏–ø–ø–∏–Ω—ã</option>
                    <option value="+62">+62 –ò–Ω–¥–æ–Ω–µ–∑–∏—è</option>
                    <option value="+91">+91 –ò–Ω–¥–∏—è</option>
                    <option value="+92">+92 –ü–∞–∫–∏—Å—Ç–∞–Ω</option>
                    <option value="+880">+880 –ë–∞–Ω–≥–ª–∞–¥–µ—à</option>
                    <option value="+94">+94 –®—Ä–∏-–õ–∞–Ω–∫–∞</option>
                    <option value="+977">+977 –ù–µ–ø–∞–ª</option>
                    <option value="+975">+975 –ë—É—Ç–∞–Ω</option>
                    <option value="+880">+880 –ë–∞–Ω–≥–ª–∞–¥–µ—à</option>
                    <option value="+93">+93 –ê—Ñ–≥–∞–Ω–∏—Å—Ç–∞–Ω</option>
                    <option value="+98">+98 –ò—Ä–∞–Ω</option>
                    <option value="+964">+964 –ò—Ä–∞–∫</option>
                    <option value="+963">+963 –°–∏—Ä–∏—è</option>
                    <option value="+961">+961 –õ–∏–≤–∞–Ω</option>
                    <option value="+962">+962 –ò–æ—Ä–¥–∞–Ω–∏—è</option>
                    <option value="+972">+972 –ò–∑—Ä–∞–∏–ª—å</option>
                    <option value="+970">+970 –ü–∞–ª–µ—Å—Ç–∏–Ω–∞</option>
                    <option value="+966">+966 –°–∞—É–¥–æ–≤—Å–∫–∞—è –ê—Ä–∞–≤–∏—è</option>
                    <option value="+971">+971 –û–ê–≠</option>
                    <option value="+974">+974 –ö–∞—Ç–∞—Ä</option>
                    <option value="+973">+973 –ë–∞—Ö—Ä–µ–π–Ω</option>
                    <option value="+965">+965 –ö—É–≤–µ–π—Ç</option>
                    <option value="+968">+968 –û–º–∞–Ω</option>
                    <option value="+967">+967 –ô–µ–º–µ–Ω</option>
                    <option value="+20">+20 –ï–≥–∏–ø–µ—Ç</option>
                    <option value="+218">+218 –õ–∏–≤–∏—è</option>
                    <option value="+216">+216 –¢—É–Ω–∏—Å</option>
                    <option value="+213">+213 –ê–ª–∂–∏—Ä</option>
                    <option value="+212">+212 –ú–∞—Ä–æ–∫–∫–æ</option>
                    <option value="+27">+27 –Æ–ê–†</option>
                    <option value="+234">+234 –ù–∏–≥–µ—Ä–∏—è</option>
                    <option value="+254">+254 –ö–µ–Ω–∏—è</option>
                    <option value="+256">+256 –£–≥–∞–Ω–¥–∞</option>
                    <option value="+250">+250 –†—É–∞–Ω–¥–∞</option>
                    <option value="+255">+255 –¢–∞–Ω–∑–∞–Ω–∏—è</option>
                    <option value="+258">+258 –ú–æ–∑–∞–º–±–∏–∫</option>
                    <option value="+260">+260 –ó–∞–º–±–∏—è</option>
                    <option value="+263">+263 –ó–∏–º–±–∞–±–≤–µ</option>
                    <option value="+264">+264 –ù–∞–º–∏–±–∏—è</option>
                    <option value="+267">+267 –ë–æ—Ç—Å–≤–∞–Ω–∞</option>
                    <option value="+268">+268 –°–≤–∞–∑–∏–ª–µ–Ω–¥</option>
                    <option value="+266">+266 –õ–µ—Å–æ—Ç–æ</option>
                    <option value="+27">+27 –Æ–ê–†</option>
                    <option value="+55">+55 –ë—Ä–∞–∑–∏–ª–∏—è</option>
                    <option value="+54">+54 –ê—Ä–≥–µ–Ω—Ç–∏–Ω–∞</option>
                    <option value="+56">+56 –ß–∏–ª–∏</option>
                    <option value="+57">+57 –ö–æ–ª—É–º–±–∏—è</option>
                    <option value="+58">+58 –í–µ–Ω–µ—Å—É—ç–ª–∞</option>
                    <option value="+51">+51 –ü–µ—Ä—É</option>
                    <option value="+52">+52 –ú–µ–∫—Å–∏–∫–∞</option>
                    <option value="+53">+53 –ö—É–±–∞</option>
                    <option value="+1">+1 –°–®–ê/–ö–∞–Ω–∞–¥–∞</option>
                    <option value="+61">+61 –ê–≤—Å—Ç—Ä–∞–ª–∏—è</option>
                    <option value="+64">+64 –ù–æ–≤–∞—è –ó–µ–ª–∞–Ω–¥–∏—è</option>
                </select>
            </div>

            <div class="register-form-group">
                <label for="phone" class="register-form-label">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                <input type="tel" id="phone" name="phone" class="register-form-input" placeholder="9991234567" maxlength="10" pattern="[0-9]{10}" required autocomplete="off">
            </div>

            <div class="register-form-group">
                <label for="password" class="register-form-label">–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="password" name="password" class="register-form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ø–∞—Ä–æ–ª—å" required autocomplete="new-password">
            </div>

            <button type="submit" class="register-button">
                <i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏
            </button>
        </form>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="register-link">
            <a href="login_username.php">–í–æ–π—Ç–∏ –ø–æ –ª–æ–≥–∏–Ω—É</a> | 
            <a href="register.html">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
        </div>
        
        <div class="register-link" style="margin-top: 15px;">
            <a href="forgot_password.html" style="color: #e74c3c;">
                <i class="fas fa-key"></i> –ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?
            </a>
        </div>
        
        <div class="register-link" style="margin-top: 20px;">
            <a href="premium.html" style="color: var(--accent); font-weight: 600;">
                <i class="fas fa-crown"></i> –ü—Ä–µ–º–∏—É–º-–∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
            </a>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Capacitor
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ LizaApp –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
            const userData = localStorage.getItem('userData');
            if (userData) {
                try {
                    const user = JSON.parse(userData);
                    if (user.username && user.sessionToken) {
                        console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º...');
                        window.location.href = 'simple-signal-test-websocket-external-js.html';
                        return;
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ userData:', error);
                    localStorage.removeItem('userData');
                }
            }
            
            console.log('üì± –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Capacitor...');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Capacitor –ø–ª–∞–≥–∏–Ω–æ–≤
            try {
                const { Camera } = await import('@capacitor/camera');
                const { PushNotifications } = await import('@capacitor/push-notifications');
                const { Network } = await import('@capacitor/network');
                
                console.log('‚úÖ Capacitor –ø–ª–∞–≥–∏–Ω—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
                
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
                await requestPermissions();
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Capacitor –ø–ª–∞–≥–∏–Ω–æ–≤:', error);
            }
        });

        // –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
        async function requestPermissions() {
            try {
                const { Camera } = await import('@capacitor/camera');
                const { PushNotifications } = await import('@capacitor/push-notifications');
                
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –∫–∞–º–µ—Ä—É
                await Camera.requestPermissions();
                console.log('‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –∫–∞–º–µ—Ä—É –∑–∞–ø—Ä–æ—à–µ–Ω—ã');
                
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                await PushNotifications.requestPermissions();
                console.log('‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞–ø—Ä–æ—à–µ–Ω—ã');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π:', error);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const countryCode = document.getElementById('countryCode').value;
            const phone = document.getElementById('phone').value;
            const password = document.getElementById('password').value;
            
            if (!phone) {
                showError('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
                return;
            }
            
            if (!password) {
                showError('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å');
                return;
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
            const cleanPhone = phone.replace(/[^0-9]/g, '');
            
            if (!cleanPhone) {
                showError('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
                return;
            }
            
            if (cleanPhone.length !== 10) {
                showError('–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 10 —Ü–∏—Ñ—Ä');
                return;
            }
            
            const username = countryCode + cleanPhone;
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º API –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            fetch('https://lizaapp.ru/api/login.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    username: username,
                    password: password
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω –ª–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                    if (data.phone_verified == 1 || data.phone_verified === 1 || data.phone_verified === '1' || data.phone_verified === true) {
                        // –ù–æ–º–µ—Ä –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        localStorage.setItem('userData', JSON.stringify({
                            username: username,
                            userId: data.userId,
                            sessionToken: data.sessionToken
                        }));
                        
                        // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                        window.location.href = 'simple-signal-test-websocket-external-js.html';
                    } else {
                        // –ù–æ–º–µ—Ä –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                        window.location.href = 'verify_phone.html?phone=' + encodeURIComponent(username);
                    }
                } else {
                    showError(data.message || '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞:', error);
                showError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            });
        });
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        document.getElementById('phone').addEventListener('input', function(e) {
            // –£–±–∏—Ä–∞–µ–º –≤—Å–µ –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä
            let value = e.target.value.replace(/[^0-9]/g, '');
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–æ 10 —Ü–∏—Ñ—Ä
            if (value.length > 10) {
                value = value.substring(0, 10);
            }
            
            e.target.value = value;
        });
        
        function showError(message) {
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            const existingError = document.querySelector('.register-error');
            if (existingError) {
                existingError.remove();
            }
            
            const existingSuccess = document.querySelector('.register-success');
            if (existingSuccess) {
                existingSuccess.remove();
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
            const errorDiv = document.createElement('div');
            errorDiv.className = 'register-error';
            errorDiv.textContent = message;
            
            // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ —Ñ–æ—Ä–º–æ–π
            const form = document.getElementById('loginForm');
            form.parentNode.insertBefore(errorDiv, form);
        }
        
        function showSuccess(message) {
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            const existingError = document.querySelector('.register-error');
            if (existingError) {
                existingError.remove();
            }
            
            const existingSuccess = document.querySelector('.register-success');
            if (existingSuccess) {
                existingSuccess.remove();
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
            const successDiv = document.createElement('div');
            successDiv.className = 'register-success';
            successDiv.textContent = message;
            
            // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ —Ñ–æ—Ä–º–æ–π
            const form = document.getElementById('loginForm');
            form.parentNode.insertBefore(successDiv, form);
        }
    </script>
</body>
</html>